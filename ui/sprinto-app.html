<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîç Sprinto Evidence Bot</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 1rem;
    }

    .app {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header Styles */
    .app-header {
      text-align: center;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      margin-bottom: 2rem;
      color: white;
    }

    .app-header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }

    .app-header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Tab Navigation */
    .tab-navigation {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .tab {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .tab.active {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    /* Main Content */
    .app-content {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 2rem;
      min-height: 600px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    /* Upload Styles */
    .upload-section h2 {
      color: #333;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }

    .upload-area {
      border: 2px dashed #ddd;
      border-radius: 15px;
      padding: 2rem;
      text-align: center;
      background: #f8f9fa;
      transition: all 0.3s ease;
      margin-bottom: 2rem;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f0f2ff;
    }

    .file-input {
      margin-bottom: 1rem;
      padding: 0.5rem;
      font-size: 1rem;
    }

    .upload-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-btn:hover:not(:disabled) {
      background: #5a67d8;
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .status {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 10px;
      font-weight: 500;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Search Styles */
    .search-section h2 {
      color: #333;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }

    .search-bar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 1rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .search-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-btn:hover:not(:disabled) {
      background: #5a67d8;
      transform: translateY(-2px);
    }

    .example-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .example-tags span {
      background: #e9ecef;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .example-tags span:hover {
      background: #667eea;
      color: white;
    }

    /* Results */
    .results-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 15px;
    }

    .documents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .document-card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .document-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .compliance-score {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#28a745 270deg, #e9ecef 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .score-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }

    .backend-status {
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }

    @media (max-width: 768px) {
      .app-header h1 {
        font-size: 2rem;
      }
      
      .tab-navigation {
        flex-direction: column;
        align-items: center;
      }
      
      .tab {
        width: 100%;
        max-width: 300px;
      }
      
      .search-bar {
        flex-direction: column;
      }
      
      .search-input {
        min-width: auto;
      }
    }

    /* AI Chat Styles */
    .chat-section {
      display: flex;
      flex-direction: column;
      height: 600px;
    }

    .chat-section h2 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    .chat-container {
      display: flex;
      flex-direction: column;
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 15px;
      overflow: hidden;
    }

    .chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f8f9fa;
      max-height: 400px;
    }

    .message {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 15px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .message.user {
      background: #667eea;
      color: white;
      margin-left: auto;
      text-align: right;
    }

    .message.ai {
      background: white;
      color: #333;
      border: 1px solid #e9ecef;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .message.typing {
      background: #e9ecef;
      color: #666;
      font-style: italic;
    }

    .chat-input-container {
      display: flex;
      padding: 1rem;
      background: white;
      border-top: 1px solid #e9ecef;
      gap: 1rem;
    }

    .chat-input {
      flex: 1;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 1rem;
      outline: none;
      resize: none;
      min-height: 20px;
      max-height: 100px;
    }

    .chat-input:focus {
      border-color: #667eea;
    }

    .chat-send-btn {
      background: #667eea;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-send-btn:hover:not(:disabled) {
      background: #5a67d8;
      transform: scale(1.1);
    }

    .chat-send-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #e9ecef;
    }

    .suggestion-chip {
      background: #e9ecef;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      border: none;
    }

    .suggestion-chip:hover {
      background: #667eea;
      color: white;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [activeTab, setActiveTab] = useState('upload');
      const [selectedFile, setSelectedFile] = useState(null);
      const [uploading, setUploading] = useState(false);
      const [uploadStatus, setUploadStatus] = useState('');
      const [documents, setDocuments] = useState([]);
      const [query, setQuery] = useState('');
      const [evidence, setEvidence] = useState(null);
      const [searching, setSearching] = useState(false);
      const [backendStatus, setBackendStatus] = useState('checking');
      
      // AI Chat state
      const [chatMessages, setChatMessages] = useState([]);
      const [chatInput, setChatInput] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [suggestions, setSuggestions] = useState([]);
      
      // GitHub state
      const [githubOwner, setGithubOwner] = useState('');
      const [githubRepo, setGithubRepo] = useState('');
      const [githubQuery, setGithubQuery] = useState('');
      const [githubEvidence, setGithubEvidence] = useState(null);
      const [githubLoading, setGithubLoading] = useState(false);

      const checkBackend = async () => {
        try {
          const response = await fetch('http://localhost:8080/api/documents');
          if (response.ok) {
            setBackendStatus('connected');
            return true;
          }
        } catch (error) {
          setBackendStatus('disconnected');
          return false;
        }
        return false;
      };

      const handleFileSelect = (event) => {
        setSelectedFile(event.target.files[0]);
        setUploadStatus('');
      };

      const handleUpload = async () => {
        if (!selectedFile) {
          setUploadStatus('Please select a file first');
          return;
        }

        if (backendStatus !== 'connected') {
          setUploadStatus('Backend not available. Please wait for Spring Boot to start.');
          return;
        }

        setUploading(true);
        const formData = new FormData();
        formData.append('file', selectedFile);

        try {
          const response = await fetch('http://localhost:8080/api/documents/upload', {
            method: 'POST',
            body: formData,
          });

          if (response.ok) {
            setUploadStatus('File uploaded successfully!');
            setSelectedFile(null);
            document.getElementById('file-input').value = '';
            fetchDocuments();
          } else {
            setUploadStatus('Upload failed. Please try again.');
          }
        } catch (error) {
          setUploadStatus('Upload error: ' + error.message);
        } finally {
          setUploading(false);
        }
      };

      const fetchDocuments = async () => {
        if (await checkBackend()) {
          try {
            const response = await fetch('http://localhost:8080/api/documents');
            if (response.ok) {
              const docs = await response.json();
              setDocuments(docs);
            }
          } catch (error) {
            console.error('Error fetching documents:', error);
          }
        }
      };

      const handleSearch = async () => {
        if (!query.trim()) return;

        if (backendStatus !== 'connected') {
          alert('Backend not available. Please wait for Spring Boot to start.');
          return;
        }

        setSearching(true);
        try {
          const response = await fetch('http://localhost:8080/api/evidence/generate', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ query: query.trim() }),
          });

          if (response.ok) {
            const result = await response.json();
            setEvidence(result);
          }
        } catch (error) {
          console.error('Search error:', error);
        } finally {
          setSearching(false);
        }
      };

      // AI Chat functions
      const fetchSuggestions = async () => {
        try {
          const response = await fetch('http://localhost:8080/api/ai/suggestions');
          if (response.ok) {
            const data = await response.json();
            setSuggestions(data.suggestions.slice(0, 6)); // Show first 6 suggestions
          }
        } catch (error) {
          console.error('Error fetching suggestions:', error);
        }
      };

      const handleChatSend = async () => {
        if (!chatInput.trim() || isTyping) return;

        if (backendStatus !== 'connected') {
          alert('Backend not available. Please wait for Spring Boot to start.');
          return;
        }

        const userMessage = chatInput.trim();
        setChatInput('');
        
        // Add user message
        const newUserMessage = {
          id: Date.now(),
          type: 'user',
          content: userMessage,
          timestamp: new Date().toLocaleTimeString()
        };
        
        setChatMessages(prev => [...prev, newUserMessage]);
        setIsTyping(true);

        try {
          const conversationHistory = chatMessages
            .map(msg => `${msg.type === 'user' ? 'User' : 'Assistant'}: ${msg.content}`)
            .join('\n');

          const response = await fetch('http://localhost:8080/api/ai/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
              query: userMessage,
              history: conversationHistory 
            }),
          });

          if (response.ok) {
            const result = await response.json();
            const aiMessage = {
              id: Date.now() + 1,
              type: 'ai',
              content: result.response,
              timestamp: new Date().toLocaleTimeString()
            };
            setChatMessages(prev => [...prev, aiMessage]);
          } else {
            throw new Error('Failed to get AI response');
          }
        } catch (error) {
          console.error('Chat error:', error);
          const errorMessage = {
            id: Date.now() + 1,
            type: 'ai',
            content: 'Sorry, I encountered an error. Please try again.',
            timestamp: new Date().toLocaleTimeString()
          };
          setChatMessages(prev => [...prev, errorMessage]);
        } finally {
          setIsTyping(false);
        }
      };

      const handleSuggestionClick = (suggestion) => {
        setChatInput(suggestion);
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleChatSend();
        }
      };
      
      // GitHub functions
      const handleGitHubEvidence = async (type) => {
        if (!githubOwner || !githubRepo) {
          alert('Please enter repository owner and name');
          return;
        }
        
        if (backendStatus !== 'connected') {
          alert('Backend not available. Please wait for Spring Boot to start.');
          return;
        }
        
        setGithubLoading(true);
        try {
          const response = await fetch('http://localhost:8080/api/github/evidence', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              owner: githubOwner,
              repo: githubRepo,
              query: githubQuery,
              type: type
            }),
          });
          
          if (response.ok) {
            const result = await response.json();
            setGithubEvidence(result);
          } else {
            throw new Error('Failed to fetch GitHub evidence');
          }
        } catch (error) {
          console.error('GitHub error:', error);
          setGithubEvidence({ error: error.message });
        } finally {
          setGithubLoading(false);
        }
      };
      
      const downloadGitHubEvidence = async (type) => {
        if (!githubOwner || !githubRepo) {
          alert('Please enter repository owner and name');
          return;
        }
        
        try {
          const response = await fetch(`http://localhost:8080/api/github/download/${githubOwner}/${githubRepo}?type=${type}`);
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `github-${type}-evidence.csv`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
          }
        } catch (error) {
          console.error('Download error:', error);
        }
      };

      useEffect(() => {
        // Check backend every 3 seconds
        const interval = setInterval(checkBackend, 3000);
        checkBackend(); // Initial check
        
        return () => clearInterval(interval);
      }, []);

      useEffect(() => {
        if (backendStatus === 'connected') {
          fetchDocuments();
        }
      }, [backendStatus]);

      useEffect(() => {
        if (backendStatus === 'connected' && activeTab === 'chat' && suggestions.length === 0) {
          fetchSuggestions();
        }
      }, [backendStatus, activeTab]);

      const getBackendStatusMessage = () => {
        switch (backendStatus) {
          case 'checking':
            return 'üîÑ Checking backend connection...';
          case 'connected':
            return '‚úÖ Backend connected and ready!';
          case 'disconnected':
            return '‚è≥ Waiting for Spring Boot backend to start (this may take a few minutes)...';
          default:
            return '';
        }
      };

      return (
        <div className="app">
          <header className="app-header">
            <h1>üîç Sprinto Evidence Bot</h1>
            <p>AI-powered Evidence-on-Demand for Compliance & Audit</p>
          </header>

          {backendStatus !== 'connected' && (
            <div className="backend-status">
              {getBackendStatusMessage()}
            </div>
          )}

          <nav className="tab-navigation">
            <button 
              className={`tab ${activeTab === 'upload' ? 'active' : ''}`}
              onClick={() => setActiveTab('upload')}
            >
              üìÅ Upload Documents
            </button>
            <button 
              className={`tab ${activeTab === 'search' ? 'active' : ''}`}
              onClick={() => setActiveTab('search')}
            >
              üîç Search Evidence
            </button>
            <button 
              className={`tab ${activeTab === 'report' ? 'active' : ''}`}
              onClick={() => setActiveTab('report')}
            >
              üìä Compliance Report
            </button>
            <button 
              className={`tab ${activeTab === 'chat' ? 'active' : ''}`}
              onClick={() => setActiveTab('chat')}
            >
              ü§ñ AI Chat
            </button>
            <button 
              className={`tab ${activeTab === 'github' ? 'active' : ''}`}
              onClick={() => setActiveTab('github')}
            >
              üîó GitHub Evidence
            </button>
          </nav>

          <main className="app-content">
            {activeTab === 'upload' && (
              <div className="upload-section">
                <h2>üìÅ Upload Documents</h2>
                <div className="upload-area">
                  <input
                    id="file-input"
                    type="file"
                    onChange={handleFileSelect}
                    accept=".pdf,.doc,.docx,.txt"
                    className="file-input"
                  />
                  <div>
                    {selectedFile ? (
                      <p>Selected: {selectedFile.name}</p>
                    ) : (
                      <p>Choose a PDF, Word document, or text file</p>
                    )}
                  </div>
                  <button
                    onClick={handleUpload}
                    disabled={uploading || !selectedFile || backendStatus !== 'connected'}
                    className="upload-btn"
                  >
                    {uploading ? 'Uploading...' : 'Upload Document'}
                  </button>
                  {uploadStatus && (
                    <div className={`status ${uploadStatus.includes('success') ? 'success' : 'error'}`}>
                      {uploadStatus}
                    </div>
                  )}
                </div>

                <h3>üìö Uploaded Documents ({documents.length})</h3>
                {documents.length === 0 ? (
                  <p>No documents uploaded yet</p>
                ) : (
                  <div className="documents-grid">
                    {documents.map((doc) => (
                      <div key={doc.id} className="document-card">
                        <h4>{doc.filename}</h4>
                        <p>Type: {doc.fileType || 'Unknown'}</p>
                        <p>Uploaded: {new Date(doc.uploadDate).toLocaleDateString()}</p>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {activeTab === 'search' && (
              <div className="search-section">
                <h2>üîç Search for Evidence</h2>
                <div className="search-bar">
                  <input
                    type="text"
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                    placeholder="Search for compliance evidence, policies, procedures..."
                    className="search-input"
                  />
                  <button
                    onClick={handleSearch}
                    disabled={searching || !query.trim() || backendStatus !== 'connected'}
                    className="search-btn"
                  >
                    {searching ? 'Searching...' : 'Search'}
                  </button>
                </div>

                <div>
                  <p>üí° Try searching for:</p>
                  <div className="example-tags">
                    <span onClick={() => setQuery('security policy')}>security policy</span>
                    <span onClick={() => setQuery('data protection')}>data protection</span>
                    <span onClick={() => setQuery('access control')}>access control</span>
                    <span onClick={() => setQuery('incident response')}>incident response</span>
                  </div>
                </div>

                {evidence && (
                  <div className="results-section">
                    <h3>üìä Evidence Found</h3>
                    <p>Query: "{evidence.query}" - {evidence.documentsFound} documents found</p>
                    
                    {evidence.documentsFound > 0 && (
                      <div>
                        <h4>üìã Summary</h4>
                        <p>{evidence.summary}</p>
                        
                        <div className="documents-grid">
                          {evidence.documents.map((doc) => (
                            <div key={doc.id} className="document-card">
                              <h5>üìÑ {doc.filename}</h5>
                              <p><strong>Type:</strong> {doc.fileType || 'Unknown'}</p>
                              <p><strong>Content Preview:</strong></p>
                              <p>{doc.content?.substring(0, 200)}...</p>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {activeTab === 'report' && (
              <div className="report-section">
                <h2>üìä Compliance Report</h2>
                <div className="compliance-score">
                  <div className="score-circle">
                    <span className="score-text">75%</span>
                  </div>
                  <h3>Compliance Score</h3>
                  <p>Good compliance posture with {documents.length} documents uploaded</p>
                </div>
                
                <div className="documents-grid">
                  <div className="document-card">
                    <h4>üìö Total Documents</h4>
                    <p style={{fontSize: '2rem', fontWeight: 'bold', color: '#667eea'}}>{documents.length}</p>
                  </div>
                  <div className="document-card">
                    <h4>üìã Policy Documents</h4>
                    <p style={{fontSize: '2rem', fontWeight: 'bold', color: '#28a745'}}>
                      {documents.filter(d => d.filename?.toLowerCase().includes('policy')).length}
                    </p>
                  </div>
                  <div className="document-card">
                    <h4>‚öôÔ∏è Procedures</h4>
                    <p style={{fontSize: '2rem', fontWeight: 'bold', color: '#ffc107'}}>
                      {documents.filter(d => d.filename?.toLowerCase().includes('procedure')).length}
                    </p>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'chat' && (
              <div className="chat-section">
                <h2>ü§ñ AI Chat Assistant</h2>
                <p style={{marginBottom: '1rem', color: '#666'}}>
                  Ask questions about your compliance documents and get AI-powered insights
                </p>
                
                <div className="chat-container">
                  <div className="chat-messages">
                    {chatMessages.length === 0 && (
                      <div className="message ai">
                        <strong>Welcome! üëã</strong><br/>
                        I'm your AI compliance assistant. I can help you:
                        <ul style={{marginTop: '0.5rem', paddingLeft: '1.5rem'}}>
                          <li>Analyze your uploaded documents</li>
                          <li>Answer questions about compliance requirements</li>
                          <li>Identify gaps in your documentation</li>
                          <li>Provide recommendations for improvement</li>
                        </ul>
                        Try asking me something about your compliance documents!
                      </div>
                    )}
                    
                    {chatMessages.map((message) => (
                      <div key={message.id} className={`message ${message.type}`}>
                        <div dangerouslySetInnerHTML={{__html: message.content.replace(/\n/g, '<br/>')}} />
                        <div style={{fontSize: '0.8rem', opacity: 0.7, marginTop: '0.5rem'}}>
                          {message.timestamp}
                        </div>
                      </div>
                    ))}
                    
                    {isTyping && (
                      <div className="message typing">
                        AI is typing...
                      </div>
                    )}
                  </div>
                  
                  <div className="chat-input-container">
                    <textarea
                      value={chatInput}
                      onChange={(e) => setChatInput(e.target.value)}
                      onKeyPress={handleKeyPress}
                      placeholder="Ask me anything about your compliance documents..."
                      className="chat-input"
                      rows="1"
                      disabled={backendStatus !== 'connected'}
                    />
                    <button
                      onClick={handleChatSend}
                      disabled={!chatInput.trim() || isTyping || backendStatus !== 'connected'}
                      className="chat-send-btn"
                      title="Send message"
                    >
                      ‚Üó
                    </button>
                  </div>
                  
                  {suggestions.length > 0 && chatMessages.length === 0 && (
                    <div className="suggestions">
                      <strong style={{width: '100%', marginBottom: '0.5rem', color: '#666'}}>
                        üí° Try these questions:
                      </strong>
                      {suggestions.map((suggestion, index) => (
                        <button
                          key={index}
                          onClick={() => handleSuggestionClick(suggestion)}
                          className="suggestion-chip"
                          disabled={backendStatus !== 'connected'}
                        >
                          {suggestion}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}
            
            {activeTab === 'github' && (
              <div className="search-section">
                <h2>üîó GitHub Evidence Retrieval</h2>
                <p style={{marginBottom: '1.5rem', color: '#666'}}>
                  Pull compliance evidence from GitHub repositories - commits, pull requests, and issues
                </p>
                
                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem'}}>
                  <input
                    type="text"
                    value={githubOwner}
                    onChange={(e) => setGithubOwner(e.target.value)}
                    placeholder="Repository Owner (e.g., microsoft)"
                    className="search-input"
                  />
                  <input
                    type="text"
                    value={githubRepo}
                    onChange={(e) => setGithubRepo(e.target.value)}
                    placeholder="Repository Name (e.g., vscode)"
                    className="search-input"
                  />
                </div>
                
                <div className="search-bar">
                  <input
                    type="text"
                    value={githubQuery}
                    onChange={(e) => setGithubQuery(e.target.value)}
                    placeholder="Search query (optional)"
                    className="search-input"
                  />
                  <button
                    onClick={() => handleGitHubEvidence('commits')}
                    disabled={githubLoading || backendStatus !== 'connected'}
                    className="search-btn"
                  >
                    {githubLoading ? 'Loading...' : 'Get Commits'}
                  </button>
                  <button
                    onClick={() => handleGitHubEvidence('prs')}
                    disabled={githubLoading || backendStatus !== 'connected'}
                    className="search-btn"
                  >
                    {githubLoading ? 'Loading...' : 'Get PRs'}
                  </button>
                  <button
                    onClick={() => handleGitHubEvidence('issues')}
                    disabled={githubLoading || backendStatus !== 'connected'}
                    className="search-btn"
                  >
                    {githubLoading ? 'Loading...' : 'Get Issues'}
                  </button>
                </div>
                
                <div>
                  <p>üí° Example repositories:</p>
                  <div className="example-tags">
                    <span onClick={() => {setGithubOwner('microsoft'); setGithubRepo('vscode');}}>microsoft/vscode</span>
                    <span onClick={() => {setGithubOwner('facebook'); setGithubRepo('react');}}>facebook/react</span>
                    <span onClick={() => {setGithubOwner('spring-projects'); setGithubRepo('spring-boot');}}>spring-projects/spring-boot</span>
                  </div>
                </div>
                
                {githubEvidence && (
                  <div className="results-section">
                    <h3>üìä GitHub Evidence Retrieved</h3>
                    <p><strong>Source:</strong> {githubEvidence.source}</p>
                    <p><strong>Repository:</strong> {githubEvidence.repository}</p>
                    <p><strong>Summary:</strong> {githubEvidence.summary}</p>
                    
                    <div style={{marginBottom: '1rem'}}>
                      <button
                        onClick={() => downloadGitHubEvidence('commits')}
                        className="search-btn"
                        style={{marginRight: '0.5rem'}}
                      >
                        üì• Download CSV
                      </button>
                    </div>
                    
                    {githubEvidence.evidence && githubEvidence.evidence.length > 0 && (
                      <div className="documents-grid">
                        {githubEvidence.evidence.map((item, index) => (
                          <div key={index} className="document-card">
                            {item.sha && (
                              <>
                                <h5>üìù Commit: {item.sha}</h5>
                                <p><strong>Message:</strong> {item.message}</p>
                                <p><strong>Author:</strong> {item.author}</p>
                                <p><strong>Date:</strong> {new Date(item.date).toLocaleDateString()}</p>
                                <a href={item.url} target="_blank" rel="noopener noreferrer">View on GitHub</a>
                              </>
                            )}
                            {item.number && (
                              <>
                                <h5>{item.title ? 'üîÄ' : 'üêõ'} #{item.number}</h5>
                                <p><strong>Title:</strong> {item.title}</p>
                                <p><strong>State:</strong> {item.state}</p>
                                <p><strong>Author:</strong> {item.author}</p>
                                <p><strong>Created:</strong> {new Date(item.created_at).toLocaleDateString()}</p>
                                <a href={item.url} target="_blank" rel="noopener noreferrer">View on GitHub</a>
                              </>
                            )}
                          </div>
                        ))}
                      </div>
                    )}
                    
                    {githubEvidence.error && (
                      <div className="status error">
                        {githubEvidence.error}
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>